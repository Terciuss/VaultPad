# VaultPad (Сейф данных)

Зашифрованное хранилище данных с архитектурой нулевого знания. Десктопное приложение для хранения паролей, ключей, документации и другой конфиденциальной информации. Все шифрование и дешифрование происходит локально — сервер никогда не видит открытые данные.

## Возможности

- **Шифрование с нулевым знанием** — AES-256-GCM с ключом на основе Argon2id, вся криптография выполняется в Rust
- **Мастер-пароль** — шифрует все проекты по умолчанию; никогда не покидает устройство
- **Индивидуальные пароли проектов** — любой проект может использовать собственный пароль вместо мастер-пароля
- **Динамическое определение пароля** — тип шифрования определяется по формату данных (V2 = мастер-ключ, V1 = пользовательский пароль), без статических флагов
- **Интеграция с системным хранилищем** — мастер-пароль и пароли проектов хранятся в связке ключей ОС (macOS Keychain, Windows Credential Manager, Linux Secret Service)
- **Быстрая разблокировка PIN-кодом** — 4-значный PIN для быстрого доступа после первоначальной настройки; опционально
- **Автоблокировка** — настраиваемый таймер бездействия очищает расшифрованные данные из памяти
- **Автосохранение** — отложенное сохранение контента с гарантированной записью при закрытии приложения
- **Работа без сети** — все данные хранятся в локальной базе SQLite; сервер не требуется
- **Опциональная синхронизация** — подключение к серверу на Go для синхронизации между устройствами (сервер хранит только зашифрованные данные)
- **Локализация** — английский и русский через react-i18next
- **Темы оформления** — системная, светлая и тёмная
- **Нативное меню** — Настройки, Новый проект, Блокировка, Подключение к серверу через системное меню ОС
- **Изменяемая ширина боковой панели** — перетаскиваемый разделитель с сохранением ширины

## Стек технологий

| Слой | Технология |
|---|---|
| Десктоп-фреймворк | [Tauri 2](https://v2.tauri.app/) (Rust + системный WebView) |
| Фронтенд | React 19, TypeScript, Vite 7, TailwindCSS 4 |
| Управление состоянием | Zustand |
| Локализация | i18next + react-i18next |
| Шифрование | AES-256-GCM (`aes-gcm`), Argon2id (`argon2`) |
| Локальная БД | SQLite (`rusqlite`, встроенная) |
| Безопасное хранилище | Связка ключей ОС (`keyring`) |
| Безопасность памяти | `zeroize` для очистки ключей и паролей |

## Требования

- **Node.js** 18+
- **Rust** 1.70+ (с `cargo`)
- **Системные зависимости** для Tauri 2: см. [требования Tauri](https://v2.tauri.app/start/prerequisites/)

## Начало работы

```bash
# Установка зависимостей фронтенда
npm install

# Запуск в режиме разработки (горячая перезагрузка фронтенда + Rust-бэкенд)
npm run tauri dev

# Сборка продакшн-версии
npm run tauri build
```

Собранное приложение будет в `src-tauri/target/release/bundle/`.

## Структура проекта

```
client/
├── src/                          # React-фронтенд
│   ├── main.tsx                  # Точка входа
│   ├── App.tsx                   # Корневой компонент, маршрутизация, инициализация
│   ├── components/
│   │   ├── InitScreen.tsx        # Первый запуск: выбор/создание базы данных
│   │   ├── MasterPasswordSetup.tsx  # Установка мастер-пароля (первый раз)
│   │   ├── UnlockScreen.tsx      # Ввод мастер-пароля
│   │   ├── PinSetup.tsx          # Установка 4-значного PIN-кода
│   │   ├── PinUnlock.tsx         # Разблокировка PIN-кодом с автопроверкой
│   │   ├── PinInput.tsx          # Переиспользуемое поле ввода PIN из 4 ячеек
│   │   ├── SplashScreen.tsx      # Экран загрузки при старте
│   │   ├── MainLayout.tsx        # Двухколоночная разметка, события меню, управление проектами
│   │   ├── Sidebar.tsx           # Список проектов с редактированием и удалением
│   │   ├── ContentView.tsx       # Редактор с отложенным автосохранением
│   │   ├── Editor.tsx            # Абстракция текстового поля (подготовлено под Tiptap)
│   │   ├── NewProjectDialog.tsx  # Создание проекта с опциональным паролем
│   │   ├── EditProjectDialog.tsx # Редактирование имени проекта, смена типа пароля
│   │   ├── DeleteProjectDialog.tsx  # Подтверждение удаления вводом имени проекта
│   │   ├── CustomPasswordDialog.tsx # Разблокировка проекта с пользовательским паролем
│   │   ├── SettingsPanel.tsx     # Тема, язык, автоблокировка, PIN, сессия
│   │   ├── LoginDialog.tsx       # Авторизация на сервере (для синхронизации)
│   │   └── Spinner.tsx           # Переиспользуемый индикатор загрузки
│   ├── hooks/
│   │   ├── useTauri.ts           # Мемоизированные обёртки над Tauri invoke
│   │   ├── useAutoLock.ts        # Таймер бездействия
│   │   └── useTheme.ts           # Системная/светлая/тёмная тема
│   ├── store/
│   │   └── index.ts              # Zustand-хранилище (экран, сессия, настройки)
│   ├── i18n/
│   │   ├── index.ts              # Инициализация i18next
│   │   └── locales/
│   │       ├── en.json           # Английские переводы
│   │       └── ru.json           # Русские переводы
│   ├── lib/
│   │   └── types.ts              # Общие TypeScript-типы
│   └── App.css                   # Импорт TailwindCSS
│
├── src-tauri/                    # Rust-бэкенд
│   ├── src/
│   │   ├── main.rs               # Точка входа Tauri
│   │   ├── lib.rs                # Настройка приложения, состояние, нативное меню, регистрация команд
│   │   ├── keychain.rs           # Чтение/запись/удаление из связки ключей ОС
│   │   ├── models.rs             # Структуры Project, DecryptedProject
│   │   ├── crypto/
│   │   │   └── mod.rs            # AES-256-GCM, Argon2id, форматы V1/V2, кэширование ключей
│   │   ├── commands/
│   │   │   ├── mod.rs            # Экспорт модулей
│   │   │   ├── projects.rs       # CRUD, динамическое определение пароля, пароли в keychain
│   │   │   ├── settings.rs       # Мастер-пароль, PIN, сессия, кэширование ключей
│   │   │   ├── auth.rs           # Серверная аутентификация (JWT)
│   │   │   └── sync.rs           # Серверная синхронизация
│   │   └── storage/
│   │       ├── mod.rs            # Трейт StorageProvider
│   │       ├── local.rs          # Реализация на SQLite
│   │       └── remote.rs         # HTTP API клиент
│   ├── Cargo.toml
│   └── tauri.conf.json
│
├── package.json
└── vite.config.ts
```

## Архитектура шифрования

```
Пользователь вводит мастер-пароль
        │
        ▼
Argon2id(пароль, соль) ──► 256-битный ключ
        │
        ▼
AES-256-GCM(ключ, nonce, открытый текст) ──► шифротекст
        │
        ▼
Хранится как: байт_версии || nonce(12) || шифротекст
```

- **Формат V2** (байт `0x02`): зашифровано кэшированным мастер-ключом (быстро, без Argon2id на каждую операцию)
- **Формат V1** (любой другой первый байт): зашифровано пользовательским паролем через полный вывод ключа Argon2id
- Для каждой операции шифрования генерируется новый случайный nonce
- Имена проектов тоже зашифрованы — сервер и база данных никогда не видят открытые имена

## Модель безопасности

- Мастер-пароль и производный ключ кэшируются в Rust `AppState` (за `Mutex`) во время разблокированной сессии
- Крейт `zeroize` очищает чувствительную память при блокировке и закрытии
- PIN валидируется через хэш Argon2id в связке ключей; PIN не используется для шифрования
- Связка ключей ОС защищает сохранённые пароли (macOS Keychain Access, Windows DPAPI, Linux Secret Service)
- Автоблокировка очищает все расшифрованные данные после настраиваемого периода бездействия
- Восстановление пароля отсутствует намеренно — потеря мастер-пароля означает потерю данных

## Сценарий работы приложения

```
Запуск
  ├─ Есть сессия? ──► Есть PIN? ──► Разблокировка PIN ──► Главный экран
  │                       │
  │                       └─ Нет PIN ──► Авторазблокировка ──► Главный экран
  │
  └─ Нет сессии ──► Выбор БД ──► Установка мастер-пароля ──► Настройка PIN (опц.) ──► Главный экран
```

## Лицензия

PolyForm Noncommercial License 1.0.0. Подробности в файле [LICENSE](LICENSE).

Copyright (c) 2026 Pavel <mr.terks@yandex.ru>
